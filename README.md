## KONGA MODULE
This repo bring to use Konga as manager for ours Kong API Gateways.

### Konga
An open source tool that enables you to manage your Kong API Gateway with ease

### Requirements
  - Terraform - Version 0.13+
  - Kubernetes - Version 0.16+
  - PostgreSQL Database - Version 9.5+
  - LDAP (optional)

### Components
  - Chart Konga - Version 0.14.9
    https://github.com/pantsel/konga

#### Example main.tf
```hcl
module "konga" {
  source = "./"

  db_host   = var.db_host
  db_name   = var.db_name
  db_pass   = var.db_pass
  db_user   = var.db_user
  namespace = "default"

  user_data = {
    "username"  = "xyz_admin",
    "email"     = "myadmin@some.domain",
    "firstName" = "xyz",
    "lastName"  = "domain",
  }
}
```
#### Module Variables
Some details about variables for this Kong module.

| Type | Key | Value | Descripcion |
|------|-----|-------|-------------|
| Required | db_host |  | PostgreSQL hostname |
| Required | db_name |  | Database name |
| Required | db_user |  | Database username |
| Required | db_pass |  | Database password |
| Optional | db_port | `5432` | Database port number|
| Optional | name | `""` | Module Konga name |
| Optional | namespace | `default` | Konga namespace |
| Optional | cpu_limit | `600m` | CPU limit in Kong deployment for DEV stage |
| Optional | cpu_request | `250m` | CPU request in Kong deployment for DEV stage |
| Optional | memory_limit_ | `400Mi` | Memory limit in Kong deployment for DEV stage |
| Optional | memory_request | `180Mi` | Memory request in Kong deployment for DEV stage |
| Optional | user_data | `{"username":"devops", "email":"devops@mail.com", "firstName":"Admin", "lastName":"Konga"}` | Autoconfigure a default user with password autogenerated for access to Konga |
| Optional | enable_ingress | `false` | Enable ingress for Konga for expose outside cluster |
| Optional | enable_ldap | `false` | When enable LDAP, Konga only use this way to authenticate |
| Optional | ldap_host | `ldap://localhost:389`| BIND DN to konga should use to login to LDAP to search users |
| Optional | ldap_bind_dn | `cn=konga,ou=admin,dc=example,dc=com`| |
| Optional | ldap_bind_pass | `secret`| BIND PASS for the user konga will use to search for users |
| Optional | ldap_user_search_base | `ou=users,dc=com`| Base DN used to search for users |
| Optional | ldap_user_search_filter | `sAMAccountName={{username}}`| The filter expression used to search for users |
| Optional | ldap_user_attrs | `sAMAccountName,uSNCreated,givenName,sn,mail"`| List of attributes to pull from the LDAP server for users |
| Optional | ldap_group_search_base | `ou=groups,dc=com`| ase DN used to search for groups |
| Optional | ldap_group_search_filter | `(|(memberUid={{uid}})(memberUid={{uidNumber}})(sAMAccountName={{uid}}))`| Filter expression used to search for groups |
| Optional | ldap_group_attrs | `cn`| List of attributes to pull from the LDAP server for groups |
| Optional | ldap_group_reg | `^(admin|konga)$`| Regular expression match a group should be administrator |
| Optional | ldap_attr_username | `sAMAccountName`| LDAP attribute as konga username |
| Optional | ldap_attr_firstname | `givenName`| LDAP attribute as konga user firstname |
| Optional | ldap_attr_lastname | `sn`| LDAP attribute as konga user lastname |
| Optional | ldap_attr_email | `mail`| LDAP attribute as konga user's email address |